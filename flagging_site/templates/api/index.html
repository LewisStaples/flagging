{% extends "base.html" %}
{% block title %}API{% endblock %}
{% block content %}
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <p>
        <strong>Note: The v1 API is still tentative and under development at this time. It will be
        finalized when this messsage is removed. The schemas may break in the meanwhile.</strong>
    </p>
    <h2>Public Flagging API</h2>
    <p>
        Pursuant to CRWA's mission to provide open access to ecological data to the greater Boston community and the
        world, the CRWA allows open access to its Public Flagging API, which provides JSON versions of the CRWA's data
        utilized in modeling, the CRWA's model outputs, and relevant metadata.
    </p>
    <p>
        The API is built on simple REST principles; user of the Public Flagging API can utilize GET requests to retrieve
        the data. Additional APIs may be added to the project as development progresses. This is a volunteer
        driven project and we appreciate developers' and researchers' input on what would be most useful.
    </p>
    <p>
        <a href="{{ url_for('flasgger.apidocs') }}" target="_blank">
            Click here to view API documentation powered by Swagger.
        </a>
    </p>
    <h2>Available Endpoints</h2>
    <ul>
        <li><a href="{{ url_for('api.reachesapi') }}" target="_blank">Flagging Model Outputs</a></li>
        <li><a href="{{ url_for('api.boathousesapi') }}" target="_blank">Boathouses</a></li>
    </ul>
    <h2>Sample code to call API</h2>
    <ul>
        <li>Calling Flagging Model Outputs</li>
        <ul>
            <li>
                using Python
                <pre class="prettyprint lang-python">
import pandas as pd
url = "{{ url_for('api.index', _external=True) }}v1/model"
model_output = pd.read_json(url)

print('version: '  + str(model_output['version'][0]) )
print('time_returned: ' + model_output['time_returned'][0])
for ind in model_output.index:
	print(ind + ":")  
	for param in model_output['models'][ind].keys():
		print('     ' + param + ':')
		print('          ' + str(model_output['models'][ind][param][-3:]))

                </pre>
            </li>
            <li>
                using R
                <pre class="prettyprint lang-r">
library(jsonlite)
url = "{{ url_for('api.index', _external=True) }}v1/model"
model_output <- fromJSON(url)

print("Version:")
print(model_output$version)
cat("\n")

print("time_returned")
print(model_output$time_returned)
cat("\n")

for (i in 1 : length(model_output$models) ) {
  print( names(model_output$models)[[i]] )
  for (j in 1: length(model_output$models[[i]]) ) {
    print( names(model_output$models[[i]])[[j]] )
    k = length(model_output$models[[i]][[j]])
    print (model_output$models[[i]][[j]][c(k-2,k-1,k)])
  }
  cat("\n")
}
                </pre>
            </li>
        </ul>
        <li>Calling Boathouse Metadata</li>
        <ul>
            <li>
                using Python<br/>
                <pre class="prettyprint lang-python">
import pandas as pd
import requests
url = "{{ url_for('api.index', _external=True) }}v1/boathouses"
records = requests.get(url).json()["boathouses"]
data = pd.DataFrame(records)
print(data.head())
                </pre>

            </li>
            <li>
                using R
                <pre class="prettyprint lang-r">
library(jsonlite)
url = "{{ url_for('api.index', _external=True) }}v1/boathouses"
boathouse_metadata <- fromJSON(url)
                    
print('Print boathouse metadata head')
print( head(boathouse_metadata$boathouses) )
                </pre>
            </li>
        </ul>
    </ul>
{% endblock %}